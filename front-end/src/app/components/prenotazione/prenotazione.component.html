<div
  class="d-flex justify-content-center text-primary align-items-center position-fixed z-3"
  *ngIf="caricamento"
  style="z-index: 1050; top: 50vh; left: 50vw; transform: translate(-50%, -50%)"
>
  <div class="spinner-border" role="status">
    <span class="visually-hidden">Loading...</span>
  </div>
</div>
<div class="container my-4 d-flex flex-column gap-3 p-2">
  <div class="d-flex justify-content-start">
    <div class="col-6 col-md-4 d-flex">
      <div class="card custom-border-radius w-100 p-3 bg-success">
        <label for="data" class="text-primary mb-2">Scegli data</label>
        <input
          type="date"
          name="data"
          class="form-control"
          (input)="onCambioData()"
          [(ngModel)]="dataSelezionata"
          [min]="mostraDaOggi()"
        />
      </div>
    </div>
    <div class="col-6 col-md-4 d-flex">
      <div class="d-flex align-items-center justify-content-center h-100 w-100">
        <a
          [routerLink]="['/partite-del-giorno']"
          class="custom-border-radius-2 border-start border-primary btn btn-success text-primary rounded-top-end shadow-none h-100 w-100 d-flex align-items-center justify-content-center"
        >
          Aggiungiti ad una partita
        </a>
      </div>
    </div>
  </div>
</div>

<div class="mt-4 mb-4 min-vh-100">
  <div class="rounded-8 w-100">
    <div
      class="text-center"
      style="min-height: 50vh"
      *ngIf="campiDisp.length < 1"
    >
      Caricamento campi
    </div>

    <div class="container d-flex flex-column gap-3 w-100 mt-4 p-2">
      <div class="row gap-4">
        <h1 *ngIf="dataOggi" class="text-primary text-start m-0">
          Disponibilità per oggi
        </h1>
        <h1 *ngIf="!dataOggi" class="text-primary text-center m-0 p-0">
          Disponibilità per il {{ formattaDataParole(dataSelezionata) }}
        </h1>
        <div class="d-flex flex-wrap gap-2 justify-content-start">
          <div *ngFor="let campo of campiDisp" class="col-3 col-lg-2">
            <button
              (click)="scrollToCampo(campo.id!)"
              class="btn btn-primary custom-button btn-sm w-100 text-success rounded-5 p-2"
              style="
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
              "
            >
              <i class="bi bi-square-half me-2"></i>{{ campo.nomeCampo }}
            </button>
          </div>
        </div>

        <div class="container">
          <div
            class="row d-flex flex-column flex-md-row gap-2 gap-md-4 justify-content-center p-3 p-md-0"
          >
            <table
              *ngFor="let campo of campiDisp"
              [id]="campo.id"
              class="table table-striped table-borderless custom-table table bg-white"
              style="border-radius: 20px; background-color: white; width: 23%"
            >
              <thead>
                <tr>
                  <th
                    class="h5 text-primary bg-success align-items-center border-0 p-3"
                    style="
                      border-top-left-radius: 20px;
                      border-top-right-radius: 20px;
                    "
                  >
                    <div class="d-flex flex-column justify-content-center">
                      <span>{{ campo.nomeCampo }}</span>
                    </div>
                  </th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let slot of getNumMaxSlotsArray()">
                  <td class="h-100">
                    <div
                      *ngIf="campo.slotOrari[slot.index]; else emptySlot"
                      class="h-100"
                    >
                      <div
                        [ngClass]="{
                          'cursor-not-allowed disabled':
                            verificaBottoneDisabilitato(
                              campo.slotOrari[slot.index].inizio
                            ),
                          
                        }"
                        (click)="
                          apriModaleCreazionePartita(
                            campo.slotOrari[slot.index].id!,
                            dataSelezionata,
                            campo.slotOrari[slot.index].inizio,
                            campo.slotOrari[slot.index].fine
                          )
                        "
                        class="position-relative d-flex align-items-center justify-content-center h-100 rounded-6"
                        style="min-height: 35px"
                      >
                        <span
                          *ngIf="!campo.slotOrari[slot.index].occupato"
                          [ngClass]="{
                            'text-success': !verificaBottoneDisabilitato(
                              campo.slotOrari[slot.index].inizio
                            ),
                            gray: verificaBottoneDisabilitato(
                              campo.slotOrari[slot.index].inizio
                            )
                          }"
                        >
                          {{
                            campo.slotOrari[slot.index].inizio | slice : 0 : 5
                          }}
                          -
                          {{ campo.slotOrari[slot.index].fine | slice : 0 : 5 }}
                        </span>
                        <div
                          *ngIf="campo.slotOrari[slot.index].occupato"
                          class="d-flex align-items-center justify-content-center h-100 w-100"
                        >
                          <span
                            [ngClass]="{
                              'bg-primary text-success':
                                campo.slotOrari[slot.index]
                                  .motivoPrenotazione == 'partita',
                              'bg-success text-primary':
                                campo.slotOrari[slot.index]
                                  .motivoPrenotazione != 'partita'
                            }"
                            class="badge px-4 py-2 rounded-6"
                            style="font-size: 12px"
                          >
                            occupato
                          </span>
                        </div>
                      </div>
                    </div>
                    <ng-template #emptySlot>
                      <div
                        style="min-height: 35px"
                        class="rounded-6 gray w-100 position-relative d-flex align-items-center justify-content-center h-100"
                      >
                        Non disponibile
                      </div>
                    </ng-template>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
